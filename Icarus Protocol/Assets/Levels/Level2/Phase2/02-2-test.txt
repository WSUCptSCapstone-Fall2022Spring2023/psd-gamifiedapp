currentPolarity = 1
switches = 0
timer = 10
locked = False
errorCode = 0


def SetPositive():
	global currentPolarity
	global switches
	global locked
	global errorCode

	if locked:
		errorCode = 3

	locked = True
	if currentPolarity > 0:
		errorCode = 1
	else:
		currentPolarity = 1
		switches += 1
		parent.push_user_scope()

def SetNegative():
	global currentPolarity
	global switches
	global locked
	global errorCode

	if locked:
		errorCode = 3

	locked = True
	if currentPolarity < 0:
		errorCode = 1
	else:
		currentPolarity = -1
		switches += 1
		parent.push_user_scope()

def simulate():
	global switches
	global locked
	global errorCode
	global currentPolarity

	try:
    		parent.execute_user_code()
	except Exception as e: 
		if "unexpected token 'else'" in repr(e):
			parent.end_simulation(4)
		elif "unexpected token '<newline>'" in repr(e):
			parent.end_simulation(5)
		elif "expected an indented block" in repr(e):
			parent.end_simulation(6)
    		else:
			parent.end_simulation(-1,repr(e))
		return

	if errorCode != 0:
		parent.end_simulation(errorCode)		
		return

	if currentPolarity > 0:
		environment.trigger_action_group(0)
	else:
		environment.trigger_action_group(1)

	locked = False
	if switches > 80:
		parent.end_simulation(0)

def simulate_tick():
	global timer
	timer -= 0.05
	if timer < 0:
		parent.end_simulation(2)
	return 0
threats = [[4,10,9,7,4,7],[1,2,10,9,1],[5,2,9,6,5]]
threatIndex = 0
errorCode = 0
maxWaves = len(threats)
firedBeams = False
firedBombs = False

def ThreatsRemaining():
	global threatIndex
	global threats

	return len(threats[threatIndex])

def ThreatSize():
	global threatIndex
	global threats
	global errorCode
	
	if len(threats[threatIndex]) == 0:
		errorCode = 3
		return

	return threats[threatIndex][0]

def FireIonBeam():
	global threats
	global threatIndex
	global errorCode
	global firedBeams

	if len(threats[threatIndex]) == 0:
		errorCode = 3
		return

	if ThreatSize() >= 5:
		errorCode = 1
	threats[threatIndex] = threats[threatIndex][1 : ]
	firedBeams = True

def FireFusionBomb():
	global threats
	global threatIndex
	global errorCode
	global firedBombs

	if len(threats[threatIndex]) == 0:
		errorCode = 3
		return

	if ThreatSize() < 5:
		errorCode = 1
	threats[threatIndex] = threats[threatIndex][1 : ]
	firedBombs = True


def simulate():
	global threats
	global threatIndex
	global firedBeams
	global firedBombs
	global maxWaves

	try:
    		parent.execute_user_code()
	except Exception as e:
		parent.end_simulation(-1, repr(e))
		return 

	if errorCode == 3:
		parent.end_simulation(3)
		return
	elif errorCode == 1:
		parent.end_simulation(1)
		return

	if firedBeams:
		environment.trigger_action_group(0)
		firedBeams = False
	if firedBombs:
		environment.trigger_action_group(1)
		firedBombs = False

	if ThreatsRemaining() == 0:
		if threatIndex == (len(threats) - 1):
			threatIndex += 1
			maxWaves -= 1
			parent.end_simulation(0)
		else:
			threatIndex += 1
			maxWaves -= 1
	else:
		parent.end_simulation(2)

def simulate_tick():
	return 0
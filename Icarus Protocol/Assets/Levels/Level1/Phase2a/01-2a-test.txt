hiddenValue = 0
totalCalls = 0
chainBroken = False
remaining = 5

def AdvanceValue(neededValue):
	global hiddenValue
	global totalCalls
	global chainBroken
	global remaining
	if hiddenValue == neededValue and not chainBroken:
		hiddenValue += 1
		remaining -= 1
		environment.trigger_action_group(neededValue)
	else:
		chainBroken = True
	totalCalls += 1

def Compress():
	AdvanceValue(1)

def Deploy():
	AdvanceValue(2)

def Prime():
	AdvanceValue(0)

def simulate():
	global hiddenValue
	global totalCalls

	try:
		parent.execute_user_code()
	except Exception as e: 
		parent.end_simulation(-1,repr(e))
		return
	
	if totalCalls < 3:
		parent.end_simulation(1)
	elif totalCalls > 3:
		parent.end_simulation(2)
	else:
		if hiddenValue == 3:
			parent.end_simulation(0)
		else:
			parent.end_simulation(3)

def simulate_tick():
	return 0